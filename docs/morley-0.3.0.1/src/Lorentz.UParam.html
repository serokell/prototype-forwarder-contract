<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass, DerivingStrategies #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# OPTIONS_GHC -Wno-redundant-constraints #-}</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lorentz.UParam</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier hs-type">EntryPointKind</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-operator hs-type">?:</span></a><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span>    </span><span class="hs-comment">-- * Construction</span><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#mkUParam"><span class="hs-identifier hs-var">mkUParam</span></a><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span>    </span><span class="hs-comment">-- * Deconstruction</span><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-type">ConstrainedSome</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#UnpackUParam"><span class="hs-identifier hs-type">UnpackUParam</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#unpackUParam"><span class="hs-identifier hs-var">unpackUParam</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- * Pattern-matching</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#EntryPointsImpl"><span class="hs-identifier hs-type">EntryPointsImpl</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#UParamFallback"><span class="hs-identifier hs-type">UParamFallback</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#EntryPointLookupError"><span class="hs-identifier hs-type">EntryPointLookupError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier hs-type">CaseUParam</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#caseUParam"><span class="hs-identifier hs-var">caseUParam</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#caseUParamT"><span class="hs-identifier hs-var">caseUParamT</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#uparamFallbackFail"><span class="hs-identifier hs-var">uparamFallbackFail</span></a><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-comment">-- * Constraints</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#LookupEntryPoint"><span class="hs-identifier hs-type">LookupEntryPoint</span></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#RequireUniqueEntryPoints"><span class="hs-identifier hs-type">RequireUniqueEntryPoints</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>    </span><span class="hs-comment">-- * Conversion from ADT</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#uparamFromAdt"><span class="hs-identifier hs-var">uparamFromAdt</span></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#UParamLinearize"><span class="hs-identifier hs-type">UParamLinearize</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#UParamLinearized"><span class="hs-identifier hs-type">UParamLinearized</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- * Internals used for entrypoint-wise migrations</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#unwrapUParam"><span class="hs-identifier hs-var">unwrapUParam</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Kind</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Kind</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vinyl.Core</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Rec</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vinyl.Derived</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Label</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vinyl.TypeLevel</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-type">++</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Fcf</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Buildable</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-type">:*:</span><span class="hs-special">)</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-type">:+:</span><span class="hs-special">)</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">G</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.TypeLits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">KnownSymbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text.Show</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.ADT.html"><span class="hs-identifier">Lorentz.ADT</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Base.html"><span class="hs-identifier">Lorentz.Base</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Coercions.html"><span class="hs-identifier">Lorentz.Coercions</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Constraints.html"><span class="hs-identifier">Lorentz.Constraints</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Errors.html"><span class="hs-identifier">Lorentz.Errors</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Instr.html"><span class="hs-identifier">Lorentz.Instr</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Macro.html"><span class="hs-identifier">Lorentz.Macro</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Interpret.Pack.html"><span class="hs-identifier">Michelson.Interpret.Pack</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Interpret.Unpack.html"><span class="hs-identifier">Michelson.Interpret.Unpack</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Interpret.Unpack.html#dummyUnpackEnv"><span class="hs-identifier hs-var">dummyUnpackEnv</span></a><span class="hs-special">,</span><span> </span><a href="Michelson.Interpret.Unpack.html#unpackValue%27"><span class="hs-identifier hs-var">unpackValue'</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Text.html"><span class="hs-identifier">Michelson.Text</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Typed.html"><span class="hs-identifier">Michelson.Typed</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Util.Type.html"><span class="hs-identifier">Util.Type</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="Util.TypeLits.html"><span class="hs-identifier">Util.TypeLits</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="Util.TypeTuple.html"><span class="hs-identifier">Util.TypeTuple</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | An entry point is described by two types: its name and type of argument.</span><span>
</span><a name="line-66"></a><span class="hs-keyword">type</span><span> </span><a name="EntryPointKind"><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier">EntryPointKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | A convenient alias for type-level name-something pair.</span><span>
</span><a name="line-69"></a><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680787202"><a href="#local-6989586621680787202"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><a name="%3F%3A"><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-operator">?:</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787203"><a href="#local-6989586621680787203"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680787201"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621680787202"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680787203"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- | Encapsulates parameter for one of entry points.</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- It keeps entry point name and corresponding argument serialized.</span><span>
</span><a name="line-73"></a><span class="hs-comment">--</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- In Haskell world, we keep an invariant of that contained value relates</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- to one of entry points from @entries@ list.</span><span>
</span><a name="line-76"></a><span class="hs-keyword">newtype</span><span> </span><a name="UParam"><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier">UParam</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787200"><a href="#local-6989586621680787200"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier hs-type">EntryPointKind</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="UParamUnsafe"><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier">UParamUnsafe</span></a></a><span> </span><span class="hs-special">(</span><a href="Michelson.Text.html#MText"><span class="hs-identifier hs-type">MText</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">anyclass</span><span> </span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#IsoValue"><span class="hs-identifier hs-type">IsoValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- Common type-level stuff</span><span>
</span><a name="line-82"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- | Get type of entry point argument by its name.</span><span>
</span><a name="line-85"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="LookupEntryPoint"><a href="Lorentz.UParam.html#LookupEntryPoint"><span class="hs-identifier">LookupEntryPoint</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787191"><a href="#local-6989586621680787191"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680787192"><a href="#local-6989586621680787192"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier hs-type">EntryPointKind</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier">LookupEntryPoint</span><span> </span><a href="#local-6989586621680787193"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621680787193"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680787194"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680787194"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-identifier">LookupEntryPoint</span><span> </span><a href="#local-6989586621680787196"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">_</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680787197"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#LookupEntryPoint"><span class="hs-identifier hs-type">LookupEntryPoint</span></a><span> </span><a href="#local-6989586621680787196"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621680787197"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-identifier">LookupEntryPoint</span><span> </span><a href="#local-6989586621680787199"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Entry point &quot;</span><span> </span><span class="hs-special">'</span><span class="hs-operator hs-type">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621680787199"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span>
</span><a name="line-91"></a><span>               </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot; in not in the entry points list&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">-- | Ensure that given entry points do no contain duplicated names.</span><span>
</span><a name="line-94"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="RequireUniqueEntryPoints"><a href="Lorentz.UParam.html#RequireUniqueEntryPoints"><span class="hs-identifier">RequireUniqueEntryPoints</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787189"><a href="#local-6989586621680787189"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier hs-type">EntryPointKind</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-96"></a><span>  </span><span class="hs-identifier">RequireUniqueEntryPoints</span><span> </span><a href="#local-6989586621680787190"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-97"></a><span>    </span><a href="Util.Type.html#RequireAllUnique"><span class="hs-identifier hs-type">RequireAllUnique</span></a><span> </span><span class="hs-string">&quot;entry point&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.Eval</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.Map</span><span> </span><span class="hs-identifier hs-type">Fcf.Fst</span><span> </span><a href="#local-6989586621680787190"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- Construction</span><span>
</span><a name="line-101"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | Construct a 'UParam' safely.</span><span>
</span><a name="line-104"></a><span class="hs-identifier">mkUParam</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621680787222"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="Michelson.Typed.Haskell.Value.html#IsoValue"><span class="hs-identifier hs-type">IsoValue</span></a><span> </span><a href="#local-6989586621680787223"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#KnownValue"><span class="hs-identifier hs-type">KnownValue</span></a><span> </span><a href="#local-6989586621680787223"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoOperation"><span class="hs-identifier hs-type">NoOperation</span></a><span> </span><a href="#local-6989586621680787223"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoBigMap"><span class="hs-identifier hs-type">NoBigMap</span></a><span> </span><a href="#local-6989586621680787223"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-106"></a><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LookupEntryPoint</span><span> </span><a href="#local-6989586621680787222"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621680787224"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621680787223"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-107"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#RequireUniqueEntryPoints"><span class="hs-identifier hs-type">RequireUniqueEntryPoints</span></a><span> </span><a href="#local-6989586621680787224"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-108"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><a href="#local-6989586621680787222"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680787223"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><a href="#local-6989586621680787224"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-110"></a><a name="mkUParam"><a href="Lorentz.UParam.html#mkUParam"><span class="hs-identifier">mkUParam</span></a></a><span> </span><span class="hs-keyword">label</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680787227"><a href="#local-6989586621680787227"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680787226"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-111"></a><span>  </span><a href="Michelson.Typed.Scope.html#forbiddenOp"><span class="hs-identifier hs-var">forbiddenOp</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#ToT"><span class="hs-identifier hs-type">ToT</span></a><span> </span><a href="#local-6989586621680787226"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Typed.Scope.html#forbiddenBigMap"><span class="hs-identifier hs-var">forbiddenBigMap</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#ToT"><span class="hs-identifier hs-type">ToT</span></a><span> </span><a href="#local-6989586621680787226"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-112"></a><span>  </span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Text.html#labelToMText"><span class="hs-identifier hs-var">labelToMText</span></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">,</span><span> </span><a href="Michelson.Interpret.Pack.html#packValue%27"><span class="hs-identifier hs-var">packValue'</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#toVal"><span class="hs-identifier hs-var">toVal</span></a><span> </span><a href="#local-6989586621680787227"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- Example</span><span>
</span><a name="line-115"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-keyword">type</span><span> </span><a name="MyEntryPoints"><a href="Lorentz.UParam.html#MyEntryPoints"><span class="hs-identifier">MyEntryPoints</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;add&quot;</span><span> </span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-operator hs-type">?:</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;reset&quot;</span><span> </span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-operator hs-type">?:</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-identifier">_mkParamSample1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><a href="Lorentz.UParam.html#MyEntryPoints"><span class="hs-identifier hs-type">MyEntryPoints</span></a><span>
</span><a name="line-123"></a><a name="_mkParamSample1"><a href="Lorentz.UParam.html#_mkParamSample1"><span class="hs-identifier">_mkParamSample1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#mkUParam"><span class="hs-identifier hs-var">mkUParam</span></a><span> </span><span class="">#add</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- Deconstruction</span><span>
</span><a name="line-127"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- | This type can store any value that satisfies a certain constraint.</span><span>
</span><a name="line-130"></a><span class="hs-keyword">data</span><span> </span><a name="ConstrainedSome"><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier">ConstrainedSome</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787186"><a href="#local-6989586621680787186"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-131"></a><span>  </span><a name="ConstrainedSome"><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier">ConstrainedSome</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680787187"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621680787188"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680787188"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-type">ConstrainedSome</span></a><span> </span><a href="#local-6989586621680787187"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-type">ConstrainedSome</span></a><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-134"></a><span>  </span><a name="local-8214565720323784705"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-var">ConstrainedSome</span></a><span> </span><a name="local-6989586621680787219"><a href="#local-6989586621680787219"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680787219"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-type">ConstrainedSome</span></a><span> </span><span class="hs-identifier hs-type">Buildable</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-137"></a><span>  </span><a name="local-8214565720323800704"><span class="hs-identifier">build</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-var">ConstrainedSome</span></a><span> </span><a name="local-6989586621680787218"><a href="#local-6989586621680787218"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">build</span><span> </span><a href="#local-6989586621680787218"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- | This class is needed to implement `unpackUParam`.</span><span>
</span><a name="line-140"></a><span class="hs-keyword">class</span><span> </span><a name="UnpackUParam"><a href="Lorentz.UParam.html#UnpackUParam"><span class="hs-identifier">UnpackUParam</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787184"><a href="#local-6989586621680787184"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680787185"><a href="#local-6989586621680787185"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-comment">-- | Turn 'UParam' into a Haskell value.</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-comment">-- Since we don't know its type in compile time, we have to erase it using</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-comment">-- 'ConstrainedSome'. The user of this function can require arbitrary</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-comment">-- constraint to hold (depending on how they want to use the result).</span><span>
</span><a name="line-145"></a><span>  </span><a name="unpackUParam"><a href="Lorentz.UParam.html#unpackUParam"><span class="hs-identifier">unpackUParam</span></a></a><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-146"></a><span>    </span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><a href="#local-6989586621680787185"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Lorentz.UParam.html#EntryPointLookupError"><span class="hs-identifier hs-type">EntryPointLookupError</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Text.html#MText"><span class="hs-identifier hs-type">MText</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-type">ConstrainedSome</span></a><span> </span><a href="#local-6989586621680787184"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.UParam.html#UnpackUParam"><span class="hs-identifier hs-type">UnpackUParam</span></a><span> </span><a href="#local-6989586621680787216"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-149"></a><span>  </span><a name="local-8214565720325562075"><a href="Lorentz.UParam.html#unpackUParam"><span class="hs-identifier">unpackUParam</span></a></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787217"><a href="#local-6989586621680787217"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#NoSuchEntryPoint"><span class="hs-identifier hs-var">NoSuchEntryPoint</span></a><span> </span><a href="#local-6989586621680787217"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-keyword">instance</span><span>
</span><a name="line-152"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621680787210"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-153"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#UnpackUParam"><span class="hs-identifier hs-type">UnpackUParam</span></a><span> </span><a href="#local-6989586621680787211"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621680787212"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Typed.Haskell.Value.html#IsoValue"><span class="hs-identifier hs-type">IsoValue</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#KnownValue"><span class="hs-identifier hs-type">KnownValue</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoOperation"><span class="hs-identifier hs-type">NoOperation</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoBigMap"><span class="hs-identifier hs-type">NoBigMap</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span>
</span><a name="line-155"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680787211"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span>
</span><a name="line-156"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.UParam.html#UnpackUParam"><span class="hs-identifier hs-type">UnpackUParam</span></a><span> </span><a href="#local-6989586621680787211"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-operator hs-type">?:</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680787212"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-157"></a><span>  </span><a name="local-8214565720325562075"><a href="Lorentz.UParam.html#unpackUParam"><span class="hs-identifier">unpackUParam</span></a></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787214"><a href="#local-6989586621680787214"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680787215"><a href="#local-6989586621680787215"><span class="hs-identifier">bytes</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680787214"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Michelson.Text.html#symbolToMText"><span class="hs-identifier hs-var">symbolToMText</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621680787210"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-159"></a><span>      </span><a href="Michelson.Typed.Scope.html#forbiddenOp"><span class="hs-identifier hs-var">forbiddenOp</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#ToT"><span class="hs-identifier hs-type">ToT</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-160"></a><span>      </span><a href="Michelson.Typed.Scope.html#forbiddenBigMap"><span class="hs-identifier hs-var">forbiddenBigMap</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#ToT"><span class="hs-identifier hs-type">ToT</span></a><span> </span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-161"></a><span>      </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680787214"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-162"></a><span>      </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="Lorentz.UParam.html#ArgumentUnpackFailed"><span class="hs-identifier hs-var">ArgumentUnpackFailed</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-163"></a><span>      </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#ConstrainedSome"><span class="hs-identifier hs-var">ConstrainedSome</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Michelson.Typed.Haskell.Value.html#fromVal"><span class="hs-identifier hs-var">fromVal</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621680787213"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-164"></a><span>      </span><a href="Michelson.Interpret.Unpack.html#unpackValue%27"><span class="hs-identifier hs-var">unpackValue'</span></a><span> </span><a href="Michelson.Interpret.Unpack.html#dummyUnpackEnv"><span class="hs-identifier hs-var">dummyUnpackEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-165"></a><span>      </span><a href="#local-6989586621680787215"><span class="hs-identifier hs-var">bytes</span></a><span>
</span><a name="line-166"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#unpackUParam"><span class="hs-identifier hs-var">unpackUParam</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621680787211"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621680787212"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680787214"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680787215"><span class="hs-identifier hs-var">bytes</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- Pattern-matching</span><span>
</span><a name="line-170"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- | Helper instruction which extracts content of 'UParam'.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">unwrapUParam</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">UParam</span></a><span> </span><a href="#local-6989586621680787220"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680787221"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-special">(</span><a href="Michelson.Text.html#MText"><span class="hs-identifier hs-type">MText</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680787221"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-174"></a><a name="unwrapUParam"><a href="Lorentz.UParam.html#unwrapUParam"><span class="hs-identifier">unwrapUParam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#coerce_"><span class="hs-identifier hs-var">coerce_</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-comment">-- | Wrapper for a single &quot;case&quot; branch.</span><span>
</span><a name="line-177"></a><span class="hs-keyword">data</span><span> </span><a name="CaseClauseU"><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier">CaseClauseU</span></a></a><span> </span><a name="local-6989586621680787177"><a href="#local-6989586621680787177"><span class="hs-identifier">inp</span></a></a><span> </span><a name="local-6989586621680787178"><a href="#local-6989586621680787178"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680787179"><a href="#local-6989586621680787179"><span class="hs-identifier">entry</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier hs-type">EntryPointKind</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-178"></a><span>  </span><a name="CaseClauseU"><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier">CaseClauseU</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">arg</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680787181"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="#local-6989586621680787182"><span class="hs-identifier hs-type">out</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-type">CaseClauseU</span></a><span> </span><a href="#local-6989586621680787181"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680787182"><span class="hs-identifier hs-type">out</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621680787183"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680787180"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">name</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621680787205"><span class="hs-identifier hs-type">name'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">body</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">arg</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680787208"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="#local-6989586621680787209"><span class="hs-identifier hs-type">out</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-181"></a><span>         </span><a href="Lorentz.ADT.html#CaseArrow"><span class="hs-identifier hs-type">CaseArrow</span></a><span> </span><a href="#local-6989586621680787205"><span class="hs-identifier hs-type">name'</span></a><span> </span><a href="#local-6989586621680787206"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-type">CaseClauseU</span></a><span> </span><a href="#local-6989586621680787208"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680787209"><span class="hs-identifier hs-type">out</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621680787204"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680787207"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>  </span><span class="hs-special">(</span><a name="local-8214565720325496281"><a href="Lorentz.ADT.html#%2F-%3E"><span class="hs-operator">/-&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-var">CaseClauseU</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- | Errors related to entry point lookup.</span><span>
</span><a name="line-185"></a><span class="hs-keyword">data</span><span> </span><a name="EntryPointLookupError"><a href="Lorentz.UParam.html#EntryPointLookupError"><span class="hs-identifier">EntryPointLookupError</span></a></a><span>
</span><a name="line-186"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoSuchEntryPoint"><a href="Lorentz.UParam.html#NoSuchEntryPoint"><span class="hs-identifier">NoSuchEntryPoint</span></a></a><span> </span><a href="Michelson.Text.html#MText"><span class="hs-identifier hs-type">MText</span></a><span>
</span><a name="line-187"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArgumentUnpackFailed"><a href="Lorentz.UParam.html#ArgumentUnpackFailed"><span class="hs-identifier">ArgumentUnpackFailed</span></a></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-identifier hs-var">deriveCustomError</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">EntryPointLookupError</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Lorentz.UParam.html#EntryPointLookupError"><span class="hs-identifier hs-type">EntryPointLookupError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-193"></a><span>  </span><a name="local-8214565720323800704"><span class="hs-identifier">build</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-195"></a><span>      </span><a href="Lorentz.UParam.html#NoSuchEntryPoint"><span class="hs-identifier hs-var">NoSuchEntryPoint</span></a><span> </span><a name="local-6989586621680788367"><a href="#local-6989586621680788367"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;No such entrypoint: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">build</span><span> </span><a href="#local-6989586621680788367"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-196"></a><span>      </span><a href="Lorentz.UParam.html#ArgumentUnpackFailed"><span class="hs-identifier hs-var">ArgumentUnpackFailed</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;UNPACK failed&quot;</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- | Implementations of some entry points.</span><span>
</span><a name="line-199"></a><span class="hs-comment">--</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- Note that this thing inherits properties of 'Rec', e.g. you can</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- @Data.Vinyl.Core.rappend@ implementations for two entry point sets</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- when assembling scattered parts of a contract.</span><span>
</span><a name="line-203"></a><span class="hs-keyword">type</span><span> </span><a name="EntryPointsImpl"><a href="Lorentz.UParam.html#EntryPointsImpl"><span class="hs-identifier">EntryPointsImpl</span></a></a><span> </span><a name="local-6989586621680788333"><a href="#local-6989586621680788333"><span class="hs-identifier">inp</span></a></a><span> </span><a name="local-6989586621680788334"><a href="#local-6989586621680788334"><span class="hs-identifier">out</span></a></a><span> </span><a name="local-6989586621680788335"><a href="#local-6989586621680788335"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-204"></a><span>  </span><span class="hs-identifier hs-type">Rec</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-type">CaseClauseU</span></a><span> </span><a href="#local-6989586621680788333"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788334"><span class="hs-identifier hs-type">out</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680788335"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- | An action invoked when user-provided entry point is not found.</span><span>
</span><a name="line-207"></a><span class="hs-keyword">type</span><span> </span><a name="UParamFallback"><a href="Lorentz.UParam.html#UParamFallback"><span class="hs-identifier">UParamFallback</span></a></a><span> </span><a name="local-6989586621680788331"><a href="#local-6989586621680788331"><span class="hs-identifier">inp</span></a></a><span> </span><a name="local-6989586621680788332"><a href="#local-6989586621680788332"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Michelson.Text.html#MText"><span class="hs-identifier hs-type">MText</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788331"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="#local-6989586621680788332"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- | Default implementation for 'UParamFallback', simply reports an error.</span><span>
</span><a name="line-210"></a><span class="hs-identifier">uparamFallbackFail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.UParam.html#UParamFallback"><span class="hs-identifier hs-type">UParamFallback</span></a><span> </span><a href="#local-6989586621680788377"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788378"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-211"></a><a name="uparamFallbackFail"><a href="Lorentz.UParam.html#uparamFallbackFail"><span class="hs-identifier">uparamFallbackFail</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-212"></a><span>  </span><a href="Lorentz.Instr.html#car"><span class="hs-identifier hs-var">car</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Errors.html#failUsingArg"><span class="hs-identifier hs-var">failUsingArg</span></a><span> </span><span class="hs-glyph">@</span><a href="Lorentz.UParam.html#EntryPointLookupError"><span class="hs-identifier hs-type">EntryPointLookupError</span></a><span> </span><span class="">#cNoSuchEntryPoint</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-comment">-- | Make up a &quot;case&quot; over entry points.</span><span>
</span><a name="line-215"></a><span class="hs-keyword">class</span><span> </span><a name="CaseUParam"><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier">CaseUParam</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680788328"><a href="#local-6989586621680788328"><span class="hs-identifier">entries</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.UParam.html#EntryPointKind"><span class="hs-identifier hs-type">EntryPointKind</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-216"></a><span>  </span><span class="hs-comment">-- | Pattern-match on given @UParam entries@.</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-comment">-- You have to provide all case branches and a fallback action on case</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-comment">-- when entry point is not found.</span><span>
</span><a name="line-220"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-comment">-- This function is unsafe because it does not make sure at type-level</span><span>
</span><a name="line-222"></a><span>  </span><span class="hs-comment">-- that entry points' names do not repeat.</span><span>
</span><a name="line-223"></a><span>  </span><a name="caseUParamUnsafe"><a href="Lorentz.UParam.html#caseUParamUnsafe"><span class="hs-identifier">caseUParamUnsafe</span></a></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Rec</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-type">CaseClauseU</span></a><span> </span><a href="#local-6989586621680788329"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788330"><span class="hs-identifier hs-type">out</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680788328"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#UParamFallback"><span class="hs-identifier hs-type">UParamFallback</span></a><span> </span><a href="#local-6989586621680788329"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788330"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">UParam</span><span> </span><a href="#local-6989586621680788328"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788329"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="#local-6989586621680788330"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier hs-type">CaseUParam</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-229"></a><span>  </span><a name="local-8214565720325563227"><a href="Lorentz.UParam.html#caseUParamUnsafe"><span class="hs-identifier">caseUParamUnsafe</span></a></a><span> </span><span class="hs-identifier hs-var">RNil</span><span> </span><a name="local-6989586621680788366"><a href="#local-6989586621680788366"><span class="hs-identifier">fallback</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#unwrapUParam"><span class="hs-identifier hs-var">unwrapUParam</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="#local-6989586621680788366"><span class="hs-identifier hs-var">fallback</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621680788356"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-232"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier hs-type">CaseUParam</span></a><span> </span><a href="#local-6989586621680788357"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-233"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#KnownValue"><span class="hs-identifier hs-type">KnownValue</span></a><span> </span><a href="#local-6989586621680788358"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoOperation"><span class="hs-identifier hs-type">NoOperation</span></a><span> </span><a href="#local-6989586621680788358"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoBigMap"><span class="hs-identifier hs-type">NoBigMap</span></a><span> </span><a href="#local-6989586621680788358"><span class="hs-identifier hs-type">arg</span></a><span>
</span><a name="line-234"></a><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-235"></a><span>         </span><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier hs-type">CaseUParam</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="Lorentz.UParam.html#%3F%3A"><span class="hs-operator hs-type">?:</span></a><span> </span><a href="#local-6989586621680788358"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788357"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>  </span><a name="local-8214565720325563227"><a href="Lorentz.UParam.html#caseUParamUnsafe"><span class="hs-identifier">caseUParamUnsafe</span></a></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-var">CaseClauseU</span></a><span> </span><a name="local-6989586621680788359"><a href="#local-6989586621680788359"><span class="hs-identifier">clause</span></a></a><span> </span><span class="hs-operator hs-var">:&amp;</span><span> </span><a name="local-6989586621680788360"><a href="#local-6989586621680788360"><span class="hs-identifier">clauses</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680788361"><a href="#local-6989586621680788361"><span class="hs-identifier">fallback</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-237"></a><span>    </span><a href="Lorentz.Instr.html#dup"><span class="hs-identifier hs-var">dup</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.UParam.html#unwrapUParam"><span class="hs-identifier hs-var">unwrapUParam</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#car"><span class="hs-identifier hs-var">car</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span>
</span><a name="line-238"></a><span>    </span><a href="Lorentz.Instr.html#push"><span class="hs-identifier hs-var">push</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Text.html#mkMTextUnsafe"><span class="hs-identifier hs-var">mkMTextUnsafe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Util.TypeLits.html#symbolValT%27"><span class="hs-identifier hs-var">symbolValT'</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621680788356"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Macro.html#eq"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span>
</span><a name="line-239"></a><span>    </span><a href="Lorentz.Instr.html#if_"><span class="hs-identifier hs-var">if_</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#unwrapUParam"><span class="hs-identifier hs-var">unwrapUParam</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#cdr"><span class="hs-identifier hs-var">cdr</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#unpack"><span class="hs-identifier hs-var">unpack</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Macro.html#assertSome"><span class="hs-identifier hs-var">assertSome</span></a><span> </span><a href="Lorentz.UParam.html#ArgumentUnpackFailed"><span class="hs-identifier hs-var">ArgumentUnpackFailed</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="#local-6989586621680788359"><span class="hs-identifier hs-var">clause</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621680788362"><span class="hs-identifier hs-var">cutUParamEntry</span></a><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.UParam.html#caseUParamUnsafe"><span class="hs-identifier hs-var">caseUParamUnsafe</span></a><span> </span><a href="#local-6989586621680788360"><span class="hs-identifier hs-var">clauses</span></a><span> </span><a href="#local-6989586621680788361"><span class="hs-identifier hs-var">fallback</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-242"></a><span>      </span><span class="hs-identifier">cutUParamEntry</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">UParam</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">e</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788364"><span class="hs-identifier hs-type">es</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788365"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">UParam</span><span> </span><a href="#local-6989586621680788364"><span class="hs-identifier hs-type">es</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788365"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-243"></a><span>      </span><a name="local-6989586621680788362"><a href="#local-6989586621680788362"><span class="hs-identifier">cutUParamEntry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.Coercions.html#coerce_"><span class="hs-identifier hs-var">coerce_</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-comment">-- | Pattern-match on given @UParam entries@.</span><span>
</span><a name="line-246"></a><span class="hs-comment">--</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- You have to provide all case branches and a fallback action on case</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- when entry point is not found.</span><span>
</span><a name="line-249"></a><span class="hs-identifier">caseUParam</span><span>
</span><a name="line-250"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier hs-type">CaseUParam</span></a><span> </span><a href="#local-6989586621680788374"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#RequireUniqueEntryPoints"><span class="hs-identifier hs-type">RequireUniqueEntryPoints</span></a><span> </span><a href="#local-6989586621680788374"><span class="hs-identifier hs-type">entries</span></a><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Rec</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-type">CaseClauseU</span></a><span> </span><a href="#local-6989586621680788375"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788376"><span class="hs-identifier hs-type">out</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680788374"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-252"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#UParamFallback"><span class="hs-identifier hs-type">UParamFallback</span></a><span> </span><a href="#local-6989586621680788375"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788376"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-253"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">UParam</span><span> </span><a href="#local-6989586621680788374"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788375"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="#local-6989586621680788376"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-254"></a><a name="caseUParam"><a href="Lorentz.UParam.html#caseUParam"><span class="hs-identifier">caseUParam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#caseUParamUnsafe"><span class="hs-identifier hs-var">caseUParamUnsafe</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">-- | Like 'caseUParam', but accepts a tuple of clauses, not a 'Rec'.</span><span>
</span><a name="line-257"></a><span class="hs-identifier">caseUParamT</span><span>
</span><a name="line-258"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">clauses</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Rec</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#CaseClauseU"><span class="hs-identifier hs-type">CaseClauseU</span></a><span> </span><a href="#local-6989586621680788371"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788372"><span class="hs-identifier hs-type">out</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680788373"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-259"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Util.TypeTuple.Class.html#RecFromTuple"><span class="hs-identifier hs-type">RecFromTuple</span></a><span> </span><a href="#local-6989586621680788370"><span class="hs-identifier hs-type">clauses</span></a><span>
</span><a name="line-260"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#CaseUParam"><span class="hs-identifier hs-type">CaseUParam</span></a><span> </span><a href="#local-6989586621680788373"><span class="hs-identifier hs-type">entries</span></a><span>
</span><a name="line-261"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Util.TypeTuple.Class.html#IsoRecTuple"><span class="hs-identifier hs-type">IsoRecTuple</span></a><span> </span><a href="#local-6989586621680788370"><span class="hs-identifier hs-type">clauses</span></a><span>
</span><a name="line-263"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#UParamFallback"><span class="hs-identifier hs-type">UParamFallback</span></a><span> </span><a href="#local-6989586621680788371"><span class="hs-identifier hs-type">inp</span></a><span> </span><a href="#local-6989586621680788372"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-264"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">UParam</span><span> </span><a href="#local-6989586621680788373"><span class="hs-identifier hs-type">entries</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788371"><span class="hs-identifier hs-type">inp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">:-&gt;</span><span> </span><a href="#local-6989586621680788372"><span class="hs-identifier hs-type">out</span></a><span>
</span><a name="line-265"></a><a name="caseUParamT"><a href="Lorentz.UParam.html#caseUParamT"><span class="hs-identifier">caseUParamT</span></a></a><span> </span><a name="local-6989586621680788379"><a href="#local-6989586621680788379"><span class="hs-identifier">clauses</span></a></a><span> </span><a name="local-6989586621680788380"><a href="#local-6989586621680788380"><span class="hs-identifier">fallback</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#caseUParamUnsafe"><span class="hs-identifier hs-var">caseUParamUnsafe</span></a><span> </span><span class="hs-special">(</span><a href="Util.TypeTuple.Class.html#recFromTuple"><span class="hs-identifier hs-var">recFromTuple</span></a><span> </span><a href="#local-6989586621680788379"><span class="hs-identifier hs-var">clauses</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680788380"><span class="hs-identifier hs-var">fallback</span></a><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">-- Example</span><span>
</span><a name="line-268"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-identifier">_caseSample</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.Base.html#%3A-%3E"><span class="hs-identifier hs-type">UParam</span></a><span> </span><a href="Lorentz.UParam.html#MyEntryPoints"><span class="hs-identifier hs-type">MyEntryPoints</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788369"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-operator">:-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680788369"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-271"></a><a name="_caseSample"><a href="Lorentz.UParam.html#_caseSample"><span class="hs-identifier">_caseSample</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#caseUParamT"><span class="hs-identifier hs-var">caseUParamT</span></a><span>
</span><a name="line-272"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="">#add</span><span> </span><a href="Lorentz.ADT.html#%2F-%3E"><span class="hs-operator hs-var">/-&gt;</span></a><span> </span><a href="Lorentz.Instr.html#nop"><span class="hs-identifier hs-var">nop</span></a><span>
</span><a name="line-273"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="">#reset</span><span> </span><a href="Lorentz.ADT.html#%2F-%3E"><span class="hs-operator hs-var">/-&gt;</span></a><span> </span><a href="Lorentz.Instr.html#drop"><span class="hs-identifier hs-var">L.drop</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Lorentz.Base.html#%23"><span class="hs-operator hs-var">#</span></a><span> </span><a href="Lorentz.Instr.html#push"><span class="hs-identifier hs-var">push</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-274"></a><span>  </span><span class="hs-special">)</span><span> </span><a href="Lorentz.UParam.html#uparamFallbackFail"><span class="hs-identifier hs-var">uparamFallbackFail</span></a><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- ADT conversion</span><span>
</span><a name="line-278"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-comment">{- @martoon: I actually hope no one will use this capability,
   it's here primarily because in other places we also use Generic stuff.

   Representation with type-level list and a datatype made polymorhpic over
   it seems more powerful than Generics.
   1. It's simpler to implement features for it. No extra boilerplate.
   2. 'Data.Vinyl' provides many useful utilities to work with such things.
   3. You are not such constrained in selecting names of entry points as when
      they come from constructor names.
-}</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-comment">-- | Make up 'UParam' from ADT sum.</span><span>
</span><a name="line-292"></a><span class="hs-comment">--</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- Entry points template will consist of</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- @(constructorName, constructorFieldType)@ pairs.</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- Each constructor is expected to have exactly one field.</span><span>
</span><a name="line-296"></a><span class="hs-identifier">uparamFromAdt</span><span>
</span><a name="line-297"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.UParam.html#UParamLinearize"><span class="hs-identifier hs-type">UParamLinearize</span></a><span> </span><a href="#local-6989586621680788368"><span class="hs-identifier hs-type">up</span></a><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680788368"><span class="hs-identifier hs-type">up</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#UParamLinearized"><span class="hs-identifier hs-type">UParamLinearized</span></a><span> </span><a href="#local-6989586621680788368"><span class="hs-identifier hs-type">up</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><a name="uparamFromAdt"><a href="Lorentz.UParam.html#uparamFromAdt"><span class="hs-identifier">uparamFromAdt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier hs-var">adtToRec</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">G.from</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- | Constraint required by 'uparamFromAdt'.</span><span>
</span><a name="line-302"></a><span class="hs-keyword">type</span><span> </span><a name="UParamLinearize"><a href="Lorentz.UParam.html#UParamLinearize"><span class="hs-identifier">UParamLinearize</span></a></a><span> </span><a name="local-6989586621680788327"><a href="#local-6989586621680788327"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span> </span><a href="#local-6989586621680788327"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621680788327"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | Entry points template derived from given ADT sum.</span><span>
</span><a name="line-305"></a><span class="hs-keyword">type</span><span> </span><a name="UParamLinearized"><a href="Lorentz.UParam.html#UParamLinearized"><span class="hs-identifier">UParamLinearized</span></a></a><span> </span><a name="local-6989586621680788326"><a href="#local-6989586621680788326"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearized"><span class="hs-identifier hs-type">GUParamLinearized</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rep</span><span> </span><a href="#local-6989586621680788326"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- | Generic traversal for conversion between ADT sum and 'UParam'.</span><span>
</span><a name="line-308"></a><span class="hs-keyword">class</span><span> </span><a name="GUParamLinearize"><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier">GUParamLinearize</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680788324"><a href="#local-6989586621680788324"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-309"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="GUParamLinearized"><a href="Lorentz.UParam.html#GUParamLinearized"><span class="hs-identifier">GUParamLinearized</span></a></a><span> </span><a name="local-6989586621680788324"><a href="#local-6989586621680788324"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-310"></a><span>  </span><a name="adtToRec"><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier">adtToRec</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680788324"><span class="hs-identifier hs-type">x</span></a><span> </span><a href="#local-6989586621680788325"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#GUParamLinearized"><span class="hs-identifier hs-type">GUParamLinearized</span></a><span> </span><a href="#local-6989586621680788324"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-keyword">instance</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><a href="#local-6989586621680788354"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.D1</span><span> </span><a href="#local-6989586621680788355"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621680788354"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-313"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">GUParamLinearized</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.D1</span><span> </span><a href="#local-6989586621680788355"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621680788354"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearized"><span class="hs-identifier hs-type">GUParamLinearized</span></a><span> </span><a href="#local-6989586621680788354"><span class="hs-identifier hs-type">x</span></a><span>
</span><a name="line-314"></a><span>  </span><a name="local-8214565720325563223"><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier">adtToRec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier hs-var">adtToRec</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">G.unM1</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><a href="#local-6989586621680788348"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><a href="#local-6989586621680788349"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-operator hs-type">:+:</span><span> </span><a href="#local-6989586621680788349"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-317"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">GUParamLinearized</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-operator hs-type">:+:</span><span> </span><a href="#local-6989586621680788349"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">GUParamLinearized</span><span> </span><a href="#local-6989586621680788348"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-operator">++</span><span> </span><a href="Lorentz.UParam.html#GUParamLinearized"><span class="hs-identifier hs-type">GUParamLinearized</span></a><span> </span><a href="#local-6989586621680788349"><span class="hs-identifier hs-type">y</span></a><span>
</span><a name="line-318"></a><span>  </span><a name="local-8214565720325563223"><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier">adtToRec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-319"></a><span>    </span><span class="hs-identifier hs-var">G.L1</span><span> </span><a name="local-6989586621680788350"><a href="#local-6989586621680788350"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><a name="local-6989586621680788351"><a href="#local-6989586621680788351"><span class="hs-identifier">up</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier hs-var">adtToRec</span></a><span> </span><a href="#local-6989586621680788350"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><a href="#local-6989586621680788351"><span class="hs-identifier hs-var">up</span></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-identifier hs-var">G.R1</span><span> </span><a name="local-6989586621680788352"><a href="#local-6989586621680788352"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><a name="local-6989586621680788353"><a href="#local-6989586621680788353"><span class="hs-identifier">up</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier hs-var">adtToRec</span></a><span> </span><a href="#local-6989586621680788352"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span> </span><a href="#local-6989586621680788353"><span class="hs-identifier hs-var">up</span></a><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621680788342"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="Michelson.Typed.Haskell.Value.html#IsoValue"><span class="hs-identifier hs-type">IsoValue</span></a><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#KnownValue"><span class="hs-identifier hs-type">KnownValue</span></a><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoOperation"><span class="hs-identifier hs-type">NoOperation</span></a><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.html#NoBigMap"><span class="hs-identifier hs-type">NoBigMap</span></a><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-323"></a><span>         </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">G.MetaCons</span><span> </span><a href="#local-6989586621680788342"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621680788344"><span class="hs-identifier hs-type">_1</span></a><span> </span><a href="#local-6989586621680788345"><span class="hs-identifier hs-type">_2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.S1</span><span> </span><a href="#local-6989586621680788346"><span class="hs-identifier hs-type">si</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rec0</span><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">GUParamLinearized</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">G.MetaCons</span><span> </span><a href="#local-6989586621680788342"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621680788344"><span class="hs-identifier hs-type">_1</span></a><span> </span><a href="#local-6989586621680788345"><span class="hs-identifier hs-type">_2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.S1</span><span> </span><a href="#local-6989586621680788346"><span class="hs-identifier hs-type">si</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.Rec0</span><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621680788342"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span>  </span><a name="local-8214565720325563223"><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier">adtToRec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.M1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.K1</span><span> </span><a name="local-6989586621680788347"><a href="#local-6989586621680788347"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.UParam.html#UParamUnsafe"><span class="hs-identifier hs-var">UParamUnsafe</span></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Michelson.Text.html#symbolToMText"><span class="hs-identifier hs-var">symbolToMText</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621680788342"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-329"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Michelson.Typed.Scope.html#forbiddenOp"><span class="hs-identifier hs-var">forbiddenOp</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#ToT"><span class="hs-identifier hs-type">ToT</span></a><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Typed.Scope.html#forbiddenBigMap"><span class="hs-identifier hs-var">forbiddenBigMap</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Typed.Haskell.Value.html#ToT"><span class="hs-identifier hs-type">ToT</span></a><span> </span><a href="#local-6989586621680788343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-330"></a><span>        </span><a href="Michelson.Interpret.Pack.html#packValue%27"><span class="hs-identifier hs-var">packValue'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Typed.Haskell.Value.html#toVal"><span class="hs-identifier hs-var">toVal</span></a><span> </span><a href="#local-6989586621680788347"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-331"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-keyword">instance</span><span>
</span><a name="line-334"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;UParam linearization requires exactly one field \
                    \in each constructor&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-336"></a><span>    </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><a href="#local-6989586621680788341"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-identifier hs-type">G.U1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-337"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">GUParamLinearized</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><a href="#local-6989586621680788341"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-identifier hs-type">G.U1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Bad linearized ADT&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>  </span><a name="local-8214565720325563223"><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier">adtToRec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;impossible&quot;</span><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-keyword">instance</span><span>
</span><a name="line-342"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;UParam linearization requires exactly one field \
                    \in each constructor&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-344"></a><span>    </span><a href="Lorentz.UParam.html#GUParamLinearize"><span class="hs-identifier hs-type">GUParamLinearize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><a href="#local-6989586621680788338"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-operator hs-type">:*:</span><span> </span><a href="#local-6989586621680788340"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">GUParamLinearized</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">G.C1</span><span> </span><a href="#local-6989586621680788338"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-operator hs-type">:*:</span><span> </span><a href="#local-6989586621680788340"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Bad linearized ADT&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>  </span><a name="local-8214565720325563223"><a href="Lorentz.UParam.html#adtToRec"><span class="hs-identifier">adtToRec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;impossible&quot;</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- Documentation</span><span>
</span><a name="line-351"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-keyword">instance</span><span> </span><a href="Michelson.Typed.Haskell.Doc.html#TypeHasDoc"><span class="hs-identifier hs-type">TypeHasDoc</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.UParam.html#UParam"><span class="hs-identifier hs-type">UParam</span></a><span> </span><a href="#local-6989586621680788336"><span class="hs-identifier hs-type">interface</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-354"></a><span>  </span><a name="local-8214565720324728069"><a href="Michelson.Typed.Haskell.Doc.html#typeDocName"><span class="hs-identifier">typeDocName</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Upgradable parameter&quot;</span><span>
</span><a name="line-355"></a><span>  </span><a name="local-8214565720324728071"><a href="Michelson.Typed.Haskell.Doc.html#typeDocMdReference"><span class="hs-identifier">typeDocMdReference</span></a></a><span> </span><a name="local-6989586621680788337"><a href="#local-6989586621680788337"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Typed.Haskell.Doc.html#customTypeDocMdReference"><span class="hs-identifier hs-var">customTypeDocMdReference</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;UParam&quot;</span><span class="hs-special">,</span><span> </span><a href="Michelson.Typed.Haskell.Doc.html#DType"><span class="hs-identifier hs-var">DType</span></a><span> </span><a href="#local-6989586621680788337"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-356"></a><span>  </span><a name="local-8214565720324728070"><a href="Michelson.Typed.Haskell.Doc.html#typeDocMdDescription"><span class="hs-identifier">typeDocMdDescription</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;UParam description&gt;&quot;</span><span>
</span><a name="line-357"></a><span>  </span><a name="local-8214565720324728073"><a href="Michelson.Typed.Haskell.Doc.html#typeDocHaskellRep"><span class="hs-identifier">typeDocHaskellRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Typed.Haskell.Doc.html#homomorphicTypeDocHaskellRep"><span class="hs-identifier hs-var">homomorphicTypeDocHaskellRep</span></a><span>
</span><a name="line-358"></a><span>  </span><a name="local-8214565720324728074"><a href="Michelson.Typed.Haskell.Doc.html#typeDocMichelsonRep"><span class="hs-identifier">typeDocMichelsonRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Typed.Haskell.Doc.html#homomorphicTypeDocMichelsonRep"><span class="hs-identifier hs-var">homomorphicTypeDocMichelsonRep</span></a><span>
</span><a name="line-359"></a></pre></body></html>